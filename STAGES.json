{
    "project_goal": "A web-first (Next.js + FastAPI) railway tampering system accepting real photo/video evidence via Clerk-authenticated mobile uploads, processed by a TWO-STAGE YOLOv8 pipeline, and displayed on a laptop dashboard.",
    "stages": [
        {
            "id": "1_scaffolding",
            "title": "Repo Scaffolding & Cleanup",
            "status": "completed",
            "tasks": [
                "Delete legacy MQTT files",
                "Create new folder structure: backend/, frontend/, uploads/, frames/, reports/",
                "Update requirements.txt for FastAPI stack"
            ]
        },
        {
            "id": "2_backend_core",
            "title": "FastAPI Backend & Uploads",
            "status": "completed",
            "tasks": [
                "Create backend/database.py: SQLite schema for Media and Incident",
                "Create backend/main.py: FastAPI app with POST /api/v1/media/upload",
                "Implement frame extraction using ffmpeg"
            ]
        },
        {
            "id": "3_ml_pipeline",
            "title": "Two-Stage YOLOv8 Inference Pipeline",
            "status": "in_progress",
            "description": "Cascade approach: Binary (fast filter) -> Detailed (classification)",
            "tasks": [
                "✅ Update scripts/train_model.py: Support 'binary', 'detailed', and 'both' modes",
                "✅ Update scripts/visualize_dataset.py: Cascade inference with severity extraction",
                "✅ Fix v1i data.yaml: 9 clean defect classes",
                "⏳ Create backend/ml_worker.py: Load both models, run cascade inference",
                "⏳ Implement Aggregator: Compute Tampering Score from cascade results"
            ],
            "models": {
                "binary": {
                    "dataset": "data/Railway Track Fault detection.v4i.yolov8",
                    "classes": [
                        "defective",
                        "non-defective"
                    ],
                    "purpose": "Fast filter - discard clean tracks"
                },
                "detailed": {
                    "dataset": "data/Railway Track Defect Detection.v1i.yolov8",
                    "classes": [
                        "broken_rail_medium",
                        "corrosion_low",
                        "head_checks_high",
                        "head_checks_low",
                        "head_checks_medium",
                        "railway_join_bar_defects_low",
                        "squats_high",
                        "squats_low",
                        "squats_medium"
                    ],
                    "purpose": "Classify defect type + severity"
                }
            }
        },
        {
            "id": "4_frontend_upload",
            "title": "Next.js Frontend: Uploads",
            "status": "pending",
            "tasks": [
                "Initialize Next.js app in frontend/",
                "Setup Clerk authentication (ClerkProvider)",
                "Create /upload page: File input (camera capture), geolocation, progress bar"
            ]
        },
        {
            "id": "5_dashboard",
            "title": "Operator Dashboard",
            "status": "pending",
            "tasks": [
                "Create /dashboard page: Poll /api/v1/incidents",
                "Implement MapCN (or Leaflet) integration for incident markers",
                "Add Incident Preview popup: Show key frame/video and Tampering Score"
            ]
        },
        {
            "id": "6_demo_prep",
            "title": "Demo & Ngrok Setup",
            "status": "pending",
            "tasks": [
                "Configure ngrok for public access",
                "Verify mobile flow: Phone Upload -> Backend Process -> Laptop Dashboard Update",
                "Create local run script for one-command startup"
            ]
        }
    ],
    "training_commands": {
        "binary_model": "python scripts/train_model.py --dataset binary --epochs 50",
        "detailed_model": "python scripts/train_model.py --dataset detailed --epochs 50",
        "both_models": "python scripts/train_model.py --dataset both"
    },
    "visualization_commands": {
        "cascade_test": "python scripts/visualize_dataset.py --mode cascade --samples 10",
        "binary_test": "python scripts/visualize_dataset.py --mode binary --samples 5",
        "detailed_test": "python scripts/visualize_dataset.py --mode detailed --samples 5"
    }
}